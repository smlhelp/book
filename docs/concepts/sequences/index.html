<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-concepts/sequences">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Sequences | SML Help</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://smlhelp.github.io/book/docs/concepts/sequences/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Sequences | SML Help"><meta data-rh="true" name="description" content="By Kaz Zhou, January 2021. Revised April 2021"><meta data-rh="true" property="og:description" content="By Kaz Zhou, January 2021. Revised April 2021"><link data-rh="true" rel="canonical" href="https://smlhelp.github.io/book/docs/concepts/sequences/"><link data-rh="true" rel="alternate" href="https://smlhelp.github.io/book/docs/concepts/sequences/" hreflang="en"><link data-rh="true" rel="alternate" href="https://smlhelp.github.io/book/docs/concepts/sequences/" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/book/assets/css/styles.5642a5db.css">
<link rel="preload" href="/book/assets/js/runtime~main.199b56ea.js" as="script">
<link rel="preload" href="/book/assets/js/main.5784b580.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/book/"><b class="navbar__title text--truncate">SML Help</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smlhelp/book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/book/docs/">Welcome!</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/book/docs/start/install/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/book/docs/types/">Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Types&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/book/docs/libs/basis/">Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/book/docs/debugging/errors/">Debugging</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/book/docs/concepts/basic/">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/basic/">Basics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Basics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/recursion/">Recursion and Induction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Recursion and Induction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/asymptotic/">Asymptotic Analysis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Asymptotic Analysis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/docs/concepts/poly/">Parametric Polymorphism</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/hof/">Higher Order Functions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Higher Order Functions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/control-flow/">Control Flow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Control Flow&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/modules/">Modules</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modules&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/book/docs/concepts/sequences/">Sequences</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/docs/concepts/lazy/">Lazy Evaluation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/docs/concepts/imperative/">Imperative Programming</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/book/docs/examples/basics/">Examples</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/book/docs/about/">About</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/book/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Sequences</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Sequences</h1><p><em>By Kaz Zhou, January 2021</em>. <em>Revised April 2021</em></p><p>In programming, we often need to write fast algorithms that use enumerable collections. Currently we use the list datatype to represent enumerable collections. There are some crucial limitations of lists though.</p><p>A great application of SML&#x27;s modules system is the sequence signature. The implementation of sequences (which is specific to 15150) allows for parallelism and accessing any element in O(1) time; it also comes with some helpful functions.</p><p>Similar to our notation for lists, our notation for sequences looks like <code>&lt;x_1, x_2, x_3, ..., x_n&gt;</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sequences-vs-lists">Sequences vs. Lists<a class="hash-link" href="#sequences-vs-lists" title="Direct link to heading">​</a></h2><p>Here are some advantages / disadvantages of sequences and lists. Considering sequences and lists purely from an algorithm-writing perspective, the only con of sequences is the slow cons operation.</p><table><thead><tr><th></th><th>Sequences</th><th>Lists</th></tr></thead><tbody><tr><td>Accessing element i</td><td>O(1)</td><td>O(i)</td></tr><tr><td>Parallelism</td><td>✅</td><td>❌</td></tr><tr><td>Pattern matching</td><td>❌</td><td>✅</td></tr><tr><td>cons operation</td><td>O(n) work</td><td>O(1) work</td></tr><tr><td>Writing proofs</td><td>Difficult</td><td>Relatively easy</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="important-sequence-functions">Important sequence functions<a class="hash-link" href="#important-sequence-functions" title="Direct link to heading">​</a></h2><p>Some frequently used sequence functions are <code>nth</code>, <code>tabulate</code>, <code>map</code>, <code>filter</code>, and <code>reduce</code>. For a comprehensive documentation of the sequence library, see <a href="http://www.cs.cmu.edu/~15150/resources/libraries/sequence.pdf" target="_blank" rel="noopener noreferrer">http://www.cs.cmu.edu/~15150/resources/libraries/sequence.pdf</a>. The following section will define each of the functions, give examples of their usage, and analyze their work and span.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seqnth"><code>Seq.nth</code><a class="hash-link" href="#seqnth" title="Direct link to heading">​</a></h3><p>The function <code>Seq.nth</code> allows for extracting any element from a sequence in O(1) work and span. This is a significant advantage over lists, which could take up to O(n) work and span, in the case of finding the last element of the list. <code>Seq.nth</code> has type <code>&#x27;a seq -&gt; int -&gt; &#x27;a seq</code>.</p><p>An example: Let&#x27;s say the sequence <code>S</code> is bound to the value <code>&lt;0, 1, 2&gt;</code>, which has type <code>int seq</code>. Then,</p><ul><li><code>Seq.nth S 0</code> evaluates to <code>0</code></li><li><code>Seq.nth S 2</code> evaluates to <code>2</code></li><li><code>Seq.nth S 5</code> raises an exception <code>Range</code>, which occurs when the index is too large or small.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seqtabulate"><code>Seq.tabulate</code><a class="hash-link" href="#seqtabulate" title="Direct link to heading">​</a></h3><p>This is a very common tool for constructing a sequence. The type of <code>Seq.tabulate</code> is <code>(int -&gt; &#x27;a) -&gt; int -&gt; &#x27;a seq</code>. The first argument is a function which maps an index to a value, and the second argument is an integer specifying the length of the sequence. In general:</p><p><code>Seq.tabulate f n ==&gt; &lt;f 0, f 1, f 2, ..., f (n-1)&gt;</code></p><p>As a concrete example:</p><p><code>Seq.tabulate (fn i =&gt; i) 5 ==&gt; &lt;0, 1, 2, 3, 4&gt;</code></p><p>Let&#x27;s try writing a function that reverses a sequence. For example,</p><p><code>reverse &lt;0, 1, 2, 3, 4&gt; ==&gt; &lt;4, 3, 2, 1, 0&gt;</code></p><p>This function <code>reverse</code> would have type <code>&#x27;a seq -&gt; &#x27;a seq</code>. In the above example, we have a sequence of length 5. The element at index 0 moves to index 4, the element at index 1 moves to index 3, ..., the element at index 4 moves to index 0. Generally, if the sequence has length <code>n</code>, the element at index <code>i</code> should move to <code>n - i - 1</code>. It&#x27;s pretty easy to make off-by-one errors here, so be careful and test sequence functions thoroughly! The implementation of <code>reverse</code> is as follows:</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">reverse</span><span class="token plain"> S </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">length S</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tabulate </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nth S </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s also possible to write functions that deal with nested sequences. Let&#x27;s write a function <code>multtable : int -&gt; int seq seq</code> that, when given a positive integer <code>n</code>, makes an <code>n</code> by <code>n</code> multiplication table. For example,</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">multtable 5 ==&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;&lt;0,0,0,0,0&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;0,1,2,3,4&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;0,2,4,6,8&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;0,3,6,9,12&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;0,4,8,12,16&gt;&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This time, the function that we&#x27;re tabulating with needs to output a sequence, like <code>&lt;0,2,4,6,8&gt;</code>.</p><p>Here is the implementation:</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">multtable</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tabulate </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tabulate </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s analyze the work of <code>multtable</code>. The function <code>(fn i =&gt; Seq.tabulate (fn j =&gt; i*j) n)</code> has <code>O(n)</code> work. This is since the function evaluates <code>i*j</code> (for different values of <code>j</code>) <code>n</code> times. The function is called <code>n</code> times (from the outer tabulate). Therefore, the total work of this function is <code>O(n^2)</code>.</p><p>For the span analysis, note that the function <code>(fn i =&gt; Seq.tabulate (fn j =&gt; i*j) n)</code> has <code>O(1)</code> span, because <code>i*j</code> is evaluated in parallel for all the different values of <code>j</code>. Then, the entire function has <code>O(1)</code> span because the function <code>(fn i =&gt; Seq.tabulate (fn j =&gt; i*j) n)</code> is called all in parallel.</p><p>In general, the cost graph for <code>Seq.tabulate</code> looks like this.</p><figure class="center_wFZg"><img src="/book/assets/images/tabulatecost-ab93e05e4f5cfb8e9b882b6ea257e95e.png" alt="tabulate cost graph"><figcaption><b>Fig <!-- -->1<!-- -->.</b> <!-- -->The cost graph for `Seq.tabulate`. Each branch at the top represents a different independent task for the processor(s) to perform.</figcaption></figure><p>The work of <code>Seq.tabulate f S</code> is the sum of all costs in the graph above. The span is the maximum cost of any one of the branches, because the function is called on 0, 1, ..., n-1 in parallel.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seqmap"><code>Seq.map</code><a class="hash-link" href="#seqmap" title="Direct link to heading">​</a></h3><p><code>Seq.map</code> is similar to <code>List.map</code>. The type of <code>Seq.map</code> is <code>(&#x27;a -&gt; &#x27;b) -&gt; &#x27;a seq -&gt; &#x27;b seq</code>. Given a function <code>f : &#x27;a -&gt; &#x27;b</code> and a sequence <code>&lt;x_1, x_2, x_3, ..., x_n&gt; : &#x27;a seq</code>, we have:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Seq.map f &lt;x_1, x_2, x_3, ..., x_n&gt; = &lt;f x_1, f x_2, f x_3, ..., f x_n&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The work of evaluating the above expression is (work of doing <code>f x_1</code>) + (work of doing <code>f x_2</code>) + ... + (work of doing <code>f x_n</code>). The calls <code>f x_1, f x_2, f x_3, ..., f x_n</code> are all done in parallel. So, the span is the max of (span of doing <code>f x_1</code>, span of doing <code>f x_2</code>, ..., span of doing <code>f x_n</code>).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seqreduce"><code>Seq.reduce</code><a class="hash-link" href="#seqreduce" title="Direct link to heading">​</a></h3><p><code>Seq.reduce</code> is like <code>List.foldr</code>, but with sequences. The type is <code>Seq.reduce : (&#x27;a * &#x27;a -&gt; &#x27;a) -&gt; &#x27;a -&gt; &#x27;a seq -&gt; &#x27;a</code>. In English, <code>Seq.reduce</code> takes in a combining function, a base value, and a sequence to &quot;reduce&quot;. For example, <code>Seq.reduce g z &lt;x_0, x_1, x_2, ..., x_n&gt;</code> is extensionally equivalent to <code>g(x_0, g(x_1, g(x_2, ..., g(x_n, z)))... )</code>. Notice that the combining function is <code>&#x27;a * &#x27;a -&gt; &#x27;a</code> instead of <code>&#x27;a * &#x27;b -&gt; &#x27;b</code>, as in <code>List.foldr</code>.</p><p>The neat part is, <code>Seq.reduce</code> also supports parallelism. In particular, when a combining function <code>g</code> has constant span, then <code>Seq.reduce g z S</code> has O(log |S|) span. We pay a slight cost: the function <code>g</code> must be associative, which means that <code>g(g(a,b),c) = g(a,g(b,c))</code> for all <code>a,b,c</code>. Furthermore, <code>z</code> must be the identity for <code>g</code>, which means <code>g(a,z) = g(z,a) = a</code> for all <code>a</code>.</p><p>To analyze the work and span, let&#x27;s consider how SML actually evaluates <code>Seq.reduce g z S</code>. It first calls the combining function <code>g</code> on each pair of elements: <code>x_0</code> and <code>x_1</code>, <code>x_2</code> and <code>x_3</code>, and so on. All of these calls can be made in parallel. Then, we combine the intermediate results together. At the very end, all of the elements of <code>S</code> will be combined together.</p><figure class="center_wFZg"><img src="/book/assets/images/reducecost-5cd73ab680af6783585c4b841e42bed4.png" alt="reduce cost graph"><figcaption><b>Fig <!-- -->2<!-- -->.</b> <!-- -->The cost graph for Seq.reduce. Each branch at the top represents a different independent task for the processor(s) to perform.</figcaption></figure><p>The work is the sum of doing all the work shown in the cost graph, while the span is the longest path through the cost graph. Therefore, for constant <code>g</code>, the work of <code>Seq.reduce g z S</code> is O(|S|), and the span is O(log |S|).</p><p>An example of using this function is finding the sum of a sequence. So, <code>Seq.reduce (op +) 0 &lt;1, 2, 3, 4&gt;</code> evaluates to <code>10</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seqfilter"><code>Seq.filter</code><a class="hash-link" href="#seqfilter" title="Direct link to heading">​</a></h3><p>Again, a sequence function is analogous to a list function. <code>Seq.filter</code> is like <code>List.filter</code>. It takes in a predicate function of type <code>&#x27;a -&gt; bool</code> and a sequence of type <code>&#x27;a seq</code>, and keeps elements <code>x</code> such that <code>p x</code> evaluates to true. However, <code>Seq.filter</code> is optimized for parallel performance. The work is O(|S|). The span is O(log |S|), which may seem surprising as the predicate function may be applied to all elements in parallel. However, it is difficult to find out the number of elements that satisfy the predicate, and thus it&#x27;s not possible to find the length of the filtered sequence in O(1). The implementation details are tricky, but use a divide-and-conquer approach just like <code>Seq.reduce</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="seqappend"><code>Seq.append</code><a class="hash-link" href="#seqappend" title="Direct link to heading">​</a></h3><p>Just like <code>@</code>, the function <code>Seq.append : &#x27;a seq * &#x27;a seq -&gt; &#x27;a seq</code> puts two sequences together. The work to create the appended sequence, such as in the call <code>Seq.append (S1,S2)</code>, is O(|S1| + |S2|). To justify this, think about how <code>Seq.append</code> may be implemented using <code>Seq.tabulate</code>. The tabulating function maps indices between 0 and |S1|-1 to elements from S1, and maps indices between |S1| and |S1 + S2| - 1 to elements from S2. Additionally, the span of <code>Seq.append</code> is O(1) regardless of the input sequences. This makes intuitive sense because <code>Seq.tabulate</code> also has O(1) span, when given a constant tabulating function.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples-of-functions-involving-sequences">Examples of functions involving sequences<a class="hash-link" href="#examples-of-functions-involving-sequences" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exercise-pascals-triangle">Exercise: Pascal&#x27;s triangle<a class="hash-link" href="#exercise-pascals-triangle" title="Direct link to heading">​</a></h2><p>Our task is to write a function <code>pascal : int -&gt; int seq seq</code>. Given a nonnegative integer <code>n</code>, <code>pascal n</code> evaluates to the first <code>n+1</code> rows of Pascal&#x27;s triangle. For example:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pascal 5 =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;&lt;1&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;1,1&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;1,2,1&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;1,3,3,1&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;1,4,6,4,1&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;1,5,10,10,5,1&gt;&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try to do this task without using the formula for entries of Pascal&#x27;s triangle. The 0th row of Pascal&#x27;s triangle is our base case. Then, we can add elements from the (n-1)th row to calculate elements in the nth row (in parallel!). This is an incremental approach: we add one row of the answer at a time.</p><p>This problem has a bit of a dynamic programming flavor, in that we should remember the previous row to help calculate new rows. One issue is that using <code>Seq.append</code> or <code>Seq.cons</code> to add a row to a sequence is expensive. However, remember the pros and cons of sequences vs. lists! Adding on a row to a list requires just O(1) work. Therefore, our approach for this problem will use both sequences and lists. The solution is below. Note that it uses the function <code>reverse</code> from the <code>Seq.tabulate</code> section of this article.</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pascalH</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">singleton </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> pascalH n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prev</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">rest</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pascalH </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rowmaker</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> rowmaker i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> n </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nth prev i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nth prev </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> new </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tabulate rowmaker </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      new</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">prev</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">rest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pascal</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reverse </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Seq</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fromList </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pascalH n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/book/docs/concepts/modules/functors/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Functors</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/book/docs/concepts/lazy/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lazy Evaluation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sequences-vs-lists" class="table-of-contents__link toc-highlight">Sequences vs. Lists</a></li><li><a href="#important-sequence-functions" class="table-of-contents__link toc-highlight">Important sequence functions</a><ul><li><a href="#seqnth" class="table-of-contents__link toc-highlight"><code>Seq.nth</code></a></li><li><a href="#seqtabulate" class="table-of-contents__link toc-highlight"><code>Seq.tabulate</code></a></li><li><a href="#seqmap" class="table-of-contents__link toc-highlight"><code>Seq.map</code></a></li><li><a href="#seqreduce" class="table-of-contents__link toc-highlight"><code>Seq.reduce</code></a></li><li><a href="#seqfilter" class="table-of-contents__link toc-highlight"><code>Seq.filter</code></a></li><li><a href="#seqappend" class="table-of-contents__link toc-highlight"><code>Seq.append</code></a></li></ul></li><li><a href="#examples-of-functions-involving-sequences" class="table-of-contents__link toc-highlight">Examples of functions involving sequences</a></li><li><a href="#exercise-pascals-triangle" class="table-of-contents__link toc-highlight">Exercise: Pascal&#39;s triangle</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/book/assets/js/runtime~main.199b56ea.js"></script>
<script src="/book/assets/js/main.5784b580.js"></script>
</body>
</html>