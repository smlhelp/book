<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-concepts/control-flow/exn">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Exceptions | SML Help</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://smlhelp.github.io/book/docs/concepts/control-flow/exn/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Exceptions | SML Help"><meta data-rh="true" name="description" content="By Brandon Wu, June 2020. Revised June 2022"><meta data-rh="true" property="og:description" content="By Brandon Wu, June 2020. Revised June 2022"><link data-rh="true" rel="canonical" href="https://smlhelp.github.io/book/docs/concepts/control-flow/exn/"><link data-rh="true" rel="alternate" href="https://smlhelp.github.io/book/docs/concepts/control-flow/exn/" hreflang="en"><link data-rh="true" rel="alternate" href="https://smlhelp.github.io/book/docs/concepts/control-flow/exn/" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/book/assets/css/styles.5642a5db.css">
<link rel="preload" href="/book/assets/js/runtime~main.dd22bac2.js" as="script">
<link rel="preload" href="/book/assets/js/main.5784b580.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/book/"><b class="navbar__title text--truncate">SML Help</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/smlhelp/book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/book/docs/">Welcome!</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/book/docs/start/install/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/book/docs/types/">Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Types&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/book/docs/libs/basis/">Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/book/docs/debugging/errors/">Debugging</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/book/docs/concepts/basic/">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/basic/">Basics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Basics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/recursion/">Recursion and Induction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Recursion and Induction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/asymptotic/">Asymptotic Analysis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Asymptotic Analysis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/docs/concepts/poly/">Parametric Polymorphism</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/hof/">Higher Order Functions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Higher Order Functions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/book/docs/concepts/control-flow/">Control Flow</a><button aria-label="Toggle the collapsible sidebar category &#x27;Control Flow&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/book/docs/concepts/control-flow/cps/">Continuation Passing Style</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/book/docs/concepts/control-flow/exn/">Exceptions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/docs/concepts/modules/">Modules</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modules&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/docs/concepts/sequences/">Sequences</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/docs/concepts/lazy/">Lazy Evaluation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/docs/concepts/imperative/">Imperative Programming</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/book/docs/examples/basics/">Examples</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/book/docs/about/">About</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/book/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/book/docs/concepts/control-flow/"><span itemprop="name">Control Flow</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Exceptions</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Exceptions</h1><p><em>By Brandon Wu, June 2020. Revised June 2022</em></p><p>So far, we have seen how we can manipulate the constructs of SML to create unique control flow behavior in the form of continuation passing style. In this section, we will discuss <em>exceptions</em>, which are themselves a builtin feature of the language. With exceptions, we can cover cases where continuing to evaluate an expression does not make sense or is ill-defined at run-time.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="built-in-exceptions">Built-In Exceptions<a class="hash-link" href="#built-in-exceptions" title="Direct link to heading">​</a></h2><p>We have seen how SML interprets computation as evaluation, and how we can reduce our entire notion of program execution to application of simple reduction rules. Sometimes, however, we run into cases where attempting to apply some rule results in an error, or in some output that we cannot actually express. In such cases, it is necessary to actually <em>halt</em> evaluation with some manner of effect - this is the behavior that exceptions will introduce.</p><p>While we would like to be able to push as many of these errors as possible to compile time, it is not always the case that this is possible - this is usually when dealing with cases where computation is made infeasible by the <em>values</em> that are bound to identifiers, which cannot be determined <em>a priori</em> at compile time. As such, we have no way of telling beforehand if such errors will occur - forcing us to define some notion of a <em>run-time error</em>.</p><p>There are numerous examples of built-in SML exceptions, however, you will encounter some far more than others. The following is a brief overview of what they are, when you will encounter them, and how to deal with them.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fail">Fail<a class="hash-link" href="#fail" title="Direct link to heading">​</a></h3><p>Whether you knew it or not, you have certainly seen <code>Fail</code> before! Whenever you have a homework problem where we give you an unimplemented function in the form <code>fun myFunction x = raise Fail &quot;Unimplemented&quot;</code> you are using the power of exceptions! <code>Fail</code> can be thought of as an all-purpose exception, nothing super special, but quite useful!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="div">Div<a class="hash-link" href="#div" title="Direct link to heading">​</a></h3><p>This one is fairly straight-forward. <code>Div</code> is raised whenever you do a division operation that is mathematically invalid such as <code>1 div 0</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="match">Match<a class="hash-link" href="#match" title="Direct link to heading">​</a></h3><p>The match exception is raised whenever you have a case of nonexhaustive pattern matching. We <em>generally</em> want our patterns to be exhaustive, meaning that no matter the input, it matches to one of the buckets established by our patterns. Consider the function <code>fn true =&gt; 1</code>, which is plainly nonexhaustive, not covering the <code>false</code> case. Nonetheless, it is a function of type <code>bool -&gt; int</code> that can be bound to an identifier. How, then, should we handle the case of attempting to evaluate <code>(fn true =&gt; 1) false</code>? This is a well-typed expression, causing it to fly under the radar of our compile-time tests. At run-time, then, we cannot evaluate this expression through function application - the function does not specify what it should return in this case! As such, we will simply raise a <code>Match</code> exception, signifying that the function&#x27;s input was not able to match to any particular clause of the function.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a class="hash-link" href="#examples" title="Direct link to heading">​</a></h4><p>Lines that cause exceptions will be marked <code>(* ! *)</code></p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">f</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> f </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> f </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">(* ! *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> x</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">xs </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">(* ! *)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bind">Bind<a class="hash-link" href="#bind" title="Direct link to heading">​</a></h3><p>Bind is similar to match, but crucially different. While Match is raised when you are unable to match with any clause, Bind is raised when you try to &quot;force&quot; a binding that cannot happen. An example of this would be <code>val 5 = 4</code>. SML we see that you are trying to force the value <code>4</code> to be assigned to the value <code>5</code> which obviously cannot happen.</p><p>In pattern matching, while we are attempting to produce a binding in case expressions/function clauses, we aren&#x27;t &quot;forcing&quot; any bindings. Instead, we are simply attempting to find a case that could match our expression (and we only bind to the pattern if we find a successful case). If we aren&#x27;t able to find a case that works, we raise <code>Match</code> to indicate that we tried to find a case that could match with our expression, but couldn&#x27;t due to non-exhaustive casing.</p><p><code>Bind</code> on the other hand is caused when we don&#x27;t even try to case to see whether a pattern works or not. Instead, we are saying that our expression <em>has</em> to bind with some pattern. If that binding cannot happen, then <code>Bind</code> is raised.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples-1">Examples<a class="hash-link" href="#examples-1" title="Direct link to heading">​</a></h4><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;polly&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;honk&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">(* could you imagine! :O *)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-exceptions-basic">Defining Exceptions: Basic<a class="hash-link" href="#defining-exceptions-basic" title="Direct link to heading">​</a></h2><p>We have now seen the built-in exceptions that are automatically raised for certain prescribed use cases. Oftentimes, however, we are interested in our own specified use cases, meaning that we likely do not want to use the exceptions <code>Div</code>, <code>Match</code>, and <code>Bind</code>, which may be unrelated. In this case, we want to define our own exceptions.</p><p>The syntax for defining exceptions is as follows:</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">exception</span><span class="token plain"> </span><span class="token class-name">Error</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This introduces the constructor named Error, which corresponds to the identically named exception Error. Exception constructors are <em>first class</em>, meaning that they are themselves values. The type of exception constructors is <code>exn</code>, so this line really introduces the value <code>Error : exn</code>. The type <code>exn</code> stands for &quot;exception name&quot;, but it is also useful to think of it as standing for &quot;extensible&quot;, since the type <code>exn</code> is <em>extensible</em>. This means that we can <em>extend</em> the values that populate <code>exn</code> with new constructors, like we did with <code>Error</code>.</p><p>The value <code>Error</code> is not, by itself, an exception, however we can use it to raise exceptions with the <code>raise</code> keyword. We can think of the <code>raise</code> keyword as being &quot;like&quot; a function of type <code>exn -&gt; &#x27;a</code>, in that it &quot;takes in&quot; a value of type <code>exn</code> and has type <code>&#x27;a</code>. It is important to remember that <code>raise</code> is <em>not</em> a function really, though - it merely has similar behavior when used to raise exceptions, but it is not first class.</p><p>The polymorphic &quot;return type&quot; of the <code>raise</code> keyword is so that raising exceptions can be compatible with our type system. Suppose we want to write a factorial function that, instead of looping forever on negative inputs, raises an exception.</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">exception</span><span class="token plain"> </span><span class="token class-name">Negative</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fact&#x27;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> fact&#x27; n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> Negative</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> fact&#x27; </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This code fragment should carry out our desired behavior. Consider the type of <code>raise Negative</code> - we would like to raise an exception, but we know that the expressions in both branches of an if then else expression must be the same type. In the positive case, this has type <code>int</code>, corresponding to just calculating the actual factorial. Therefore the negative case must also be <code>int</code>, though we also want to raise an exception. To be compatible with this, <code>raise Negative</code> must have type <code>int</code>.</p><p>We would not like <code>raise Negative</code> to have type <code>int</code> in <em>general</em>, however - this depends on our use case! We want raising exceptions to be able to just <em>work</em>, type-wise, since we know that it never returns a well-defined value anyways. As such, we define raising exceptions to have a <em>polymorphic</em> return type, so that it fits within our type system correctly, no matter the use case. This is also the reason why we can write <code>raise Fail &quot;Unimplemented&quot;</code> as the output of not-yet defined functions and still pass typechecking, no matter how complicated the function.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exceptional-control-flow">Exceptional Control Flow<a class="hash-link" href="#exceptional-control-flow" title="Direct link to heading">​</a></h2><p>At this point, we have seen how exceptions let us implement a very limited form of &quot;control flow&quot;, in that we can stop the flow of control entirely - upon encountering a raised exception, computation ceases. This is rather rudimentary in terms of expressiveness - we can only create programs that forcibly terminate! In this section, however, we will explore the usage of <code>handle</code>, a keyword that allows us to have more sophisticated behavior with respect to programs deal with raised exceptions.</p><blockquote><p><strong>[handle]</strong> For expressions <code>e : t</code>, <code>e1 : t</code> ... <code>en : t</code>, and different values <code>Exn1 : exn</code> ... <code>ExnN : exn</code>, if the expression <code>e</code> raises the exception <code>ExnI</code>, then the expression</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">e </span><span class="token keyword" style="color:#00009f">handle</span><span class="token plain"> Exn2 </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> e1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Exn2 </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> e3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ExnN </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> en</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>reduces to <code>eI</code>.</p><p>In other words, the <code>handle</code> keyword lets us case on the exception raised by an expression.</p></blockquote><p>It is important to note that all the expressions <code>e</code>, <code>e1</code>, ... <code>en</code> have to be of the same type. Consider what would happen if they were not:</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">e </span><span class="token keyword" style="color:#00009f">handle</span><span class="token plain"> Div </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Oh no!&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let <code>e</code> be an expression of type <code>int</code>. Suppose that, in this case, <code>e</code> raises <code>Div</code>, so ostensibly this expression should reduce to <code>&quot;Oh no!&quot;</code>. However, what would happen if <code>Div</code> was not raised? Then, we would have <code>e</code>, which is of type <code>int</code>.</p><p>We&#x27;ve violated type safety here. We cannot &quot;sometimes&quot; have an expression be one type and another time have it be another. We must have <em>static type guarantees</em>. As such, all the arms of a <code>handle</code> must agree, and additionally they must agree with the type of the expression being handled.</p><p>We say that an exception that is raised can either propagate up to the <em>top level</em> (in which case the program or expression simply results in an uncaught exception), or to the <em>nearest handler</em>. To clarify the meaning of &quot;nearest&quot;, take the evaluation of the expression <code>(1 + (1 div 0)) * 3 handle Div =&gt; 5</code>, for example. We see that <code>1 div 0</code> raises the exception <code>Div</code>, so the inner expression is extensionally equivalent to <code>(1 + raise Div) * 3</code>. Then, applying this logic one more time, <code>1 + raise Div</code> clearly should also raise <code>Div</code>, so we get that it is extensionally equivalent to <code>raise Div * 3</code>, which is then extensionally equivalent to <code>raise Div</code>. What we see is that this raised exception &quot;propagates up&quot; as it subsumes more and more expressions, until eventually it reaches a handler.</p><p>While we now see how we can handle different kinds of exceptions, we might want to make a more educated choice about what our next action should be. It might be the case that we raise an exception in some failed branch of the program, but we want to have more information about exactly what happened, or what the program was doing at the time. We will now discuss <em>information-carrying exceptions</em>, which are nothing other than an extension of our declarations of exceptions to being more akin to how we declare datatypes.</p><p>In a similar vein to how we can declare <code>datatype Foo = Bar of int</code> to denote that a value of type <code>Foo</code> is the constructor <code>Bar</code> wrapping a value of type <code>int</code>, we can declare values of type <code>exn</code> to also be constructors wrapping values. This takes the form:</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">exception</span><span class="token plain"> </span><span class="token class-name">Crash</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which denotes that <code>Crash 1</code> and <code>Crash 5</code>, among others, are values of type <code>exn</code>, and can thus be <code>raise</code>d. Note that <code>Crash</code> thus has type <code>int -&gt; exn</code>.</p><p>Concretely, we can &quot;pattern match&quot; on the data contained by the exception handler by doing something like the following:</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">exception</span><span class="token plain"> </span><span class="token class-name">Return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">factException</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> Return </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> factException n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> factException </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">handle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Return res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> Return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>NOTE:</strong> It is not clear why anyone would want to define <code>fact</code> this way.</p><p>This example makes use of an exception, <code>Return : int -&gt; exn</code>, which wraps the return value of <code>fact</code>. <code>fact</code>, at each step, simply raises an exception containing its return value, which (in a future recursive call) is handled, the value unwrapped (bound to <code>res</code>), then multiplied by the current value of <code>n</code> to generate the next value, which is simply raised again. This is very similar to a <code>case</code> expression - we simply pattern match on the raised exception&#x27;s constructor using the handler (you can pattern match on exception constructors with <code>case</code> as well, though not <em>raised</em> exceptions). Thus, the behavior of <code>factException n</code> is to be extensionally equivalent to <code>raise Return (fact n)</code>.</p><p>For an abstract idea of a potential use case, consider some recursive function <code>f</code> that carries out some sequence of calculations, with a potential for error. We might be interested in how many recursive calls such a function makes when it ultimately fails - however, if we were to return the number of recursive calls, we would constrain the return type to be <code>int</code>, or barring that, some datatype that could be either a valid result (say, <code>Valid res</code>) or a signal for failure, with a line number (say, <code>Fail line</code>). We might desire that on a fail, execution actually stops, however. We could then simply raise the exception <code>Crash line</code>, which, as a raised exception, has a polymorphic type. As such, exceptions allow us to propagate back information <em>without altering types</em>, which can be convenient for our purposes.</p><p>For a concrete example of using such exceptions, see the next section.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exception-handling-style">Exception Handling Style<a class="hash-link" href="#exception-handling-style" title="Direct link to heading">​</a></h2><p>In the previous section, we discussed how continuation passing style could be used to devise complicated control flow schemas, in some instances being based around the idea of a <em>success</em> and <em>failure</em> continuation, which could both potentially execute disjoint sets of instructions. With continuations, we can relate them to a common other construct in programming languages, that being a <em>goto</em>. With a goto, we abandon whatever we are currently in the process of doing in favor of something else. In this, we can see that continuations and exceptions share similar characteristics, of being able to just &quot;stop&quot; execution in favor of some other route.</p><p>Consider the knapsack example from the previous section. We will now implement a solution to the knapsack problem using exception handling style.</p><div class="language-sml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">exception</span><span class="token plain"> </span><span class="token class-name">Failure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">weight</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token class-name">value</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">(* knapsackEHS :</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *            (value * weight) list -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *            value -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *            weight -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *            ((value * weight) list -&gt; &#x27;a) -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *            &#x27;a</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * REQUIRES: The weights and values of the elements in L are strictly positive.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * ENSURES: knapsackEHS L minVal maxWeight sc fc ~= sc L&#x27; for some L&#x27; that only</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * contains elements of L, such that the total value of L&#x27; &gt;= minVal and the</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * total weight of L&#x27; &lt;= maxWeight, if such an L&#x27; exists. If no such L&#x27; exists,</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * then it should be equivalent to raise Failure.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">knapsackEHS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">L </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name punctuation" style="color:#393A34">(</span><span class="token class-name">value </span><span class="token class-name operator" style="color:#393A34">*</span><span class="token class-name"> weight</span><span class="token class-name punctuation" style="color:#393A34">)</span><span class="token class-name"> list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">minVal </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">maxWeight </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">weight</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sc </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name punctuation" style="color:#393A34">(</span><span class="token class-name">value </span><span class="token class-name operator" style="color:#393A34">*</span><span class="token class-name"> weight</span><span class="token class-name punctuation" style="color:#393A34">)</span><span class="token class-name"> list </span><span class="token class-name operator" style="color:#393A34">-&gt;</span><span class="token class-name"> </span><span class="token class-name variable" style="color:#36acaa">&#x27;a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name variable" style="color:#36acaa">&#x27;a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> L </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> minVal </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">andalso</span><span class="token plain"> maxWeight </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> sc </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> Failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">xs </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> maxWeight </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> Failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                   </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    knapsackEHS </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">xs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">minVal </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> v</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">maxWeight </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> L&#x27; </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> sc </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">L&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">handle</span><span class="token plain"> Failure </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> knapsackEHS xs minVal maxWeight sc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It should be apparent that this function shares very close similarities to <code>knapsackCPS</code>, with the exception<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> of omitting the failure continuation for raising the <code>Failure</code> exception. In fact, we can claim that <code>knapsackCPS L minVal maxWeight sc fc ~= knapsackEHS L minVal maxWeight sc handle Failure =&gt; fc ()</code>, for all relevant values. Take a moment to assure yourself that this is the case. The code does not look very different, with the largest change being the recursive case, where the failure continuation has instead been offloaded to a handler.</p><p>Recall that we can think of the recursive call in the knapsack problem as a &quot;choice&quot; to &quot;keep&quot; or &quot;not keep&quot; the item at the head of the list. We said previously that, arbitrarily, we could commit to the choice of &quot;keep&quot;, with a provision in the failure continuation to instead &quot;not keep&quot;, should that failure continuation ever be executed. When evaluating the expression <code>knapsackEHS ((v, w)::xs) (minVal - v) (maxWeight - w) (fn L&#x27; =&gt; sc ((v, w)::L&#x27;))</code><sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>, we know that one of two things can happen - it can either <em>succeed</em> or <em>fail</em>. Now, however, our definition of failure is different - instead of calling its failure continuation, an instance of <code>knapsackEHS</code> which fails should instead raise <code>Failure</code>. Thus, it is exactly the right thing to do to do what we would ordinarily do upon a failure, should our call to <code>knapsackEHS</code> raise <code>Failure</code>.</p><p>Note, however, that in this implementation we put a slight amount more burden on the user, since the ill-defined behavior of this function now results in a raised <code>Failure</code>, instead of just invoking <code>fc ()</code>, for some pre-defined <code>fc</code> that we input. This offers us the same advantages, however, since the return types of <code>sc</code> and <code>fc</code> in <code>knapsackCPS</code> must be the same. As such, if we want <code>knapsackCPS</code> to return some indicative value (without using an option type), we might not have an appropriate return value for the failure case. Thus, <code>knapsackEHS</code> might have the behavior we&#x27;re looking for, since the type of <code>raise Failure</code> allows us to &quot;unconstrain&quot; the type of our success. In the general case, however, we will not make heavy usage of exception handling style, in favor of continuation passing style, which can be cleaner.</p><p>This is not the most committed that we could have made <code>knapsackEHS</code>, when converting to exception handling style - we could have also represented <em>success continuations</em> with a raised exception, an <code>exception Success of (int * int) list</code>. We will not cover such an implementation in this chapter, but we invite the reader to try it out.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusions">Conclusions<a class="hash-link" href="#conclusions" title="Direct link to heading">​</a></h2><p>In this chapter, we explored <em>exceptions</em>, which allow us to have quick transfers of control flow, albeit in a less &quot;controlled&quot; fashion than ways that we have seen in the past. The success of so-called <em>exception handling style</em> is heavily contingent on intelligent placement and consideration of <em>handlers</em>, which decide where control is transferred to. We also have seen that we have a way of passing information back <em>through</em> the raised exception, which allows us to have a more powerful manner of communication than just an indicator of failure. Exceptions ultimately allow us a robust and type-safe way to deal with run-time errors in our programs.</p><div class="footnotes"><hr><ol><li id="fn-1">We&#x27;re funny.<a href="#fnref-1" class="footnote-backref">↩</a></li><li id="fn-2">Say that five times fast.<a href="#fnref-2" class="footnote-backref">↩</a></li></ol></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/book/docs/concepts/control-flow/cps/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Continuation Passing Style</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/book/docs/concepts/modules/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Modules</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#built-in-exceptions" class="table-of-contents__link toc-highlight">Built-In Exceptions</a><ul><li><a href="#fail" class="table-of-contents__link toc-highlight">Fail</a></li><li><a href="#div" class="table-of-contents__link toc-highlight">Div</a></li><li><a href="#match" class="table-of-contents__link toc-highlight">Match</a></li><li><a href="#bind" class="table-of-contents__link toc-highlight">Bind</a></li></ul></li><li><a href="#defining-exceptions-basic" class="table-of-contents__link toc-highlight">Defining Exceptions: Basic</a></li><li><a href="#exceptional-control-flow" class="table-of-contents__link toc-highlight">Exceptional Control Flow</a></li><li><a href="#exception-handling-style" class="table-of-contents__link toc-highlight">Exception Handling Style</a></li><li><a href="#conclusions" class="table-of-contents__link toc-highlight">Conclusions</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/book/assets/js/runtime~main.dd22bac2.js"></script>
<script src="/book/assets/js/main.5784b580.js"></script>
</body>
</html>